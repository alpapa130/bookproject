{% extends 'base.html' %}

{% block title %}IT Bookfolio{% endblock %}

{% block content %}
  {# トップページのヒーローエリア。アプリの概要を紹介する #}
  <section class="hero-card">
    <div class="hero-card__title">IT Bookfolio</div>
    <p class="hero-card__subtitle">技術書から絵本まで、あなたが読んだIT本を共有し、みんなでレビューを投稿しよう！</p>
  </section>

  {# カテゴリフィルタ。選択されているカテゴリを強調表示する #}
  {% if categories %}
    <section class="category-bar">
      <span class="category-bar__label">カテゴリで絞り込み</span>
      <a class="category-pill{% if not current_category %} is-active{% endif %}" href="?{% if current_query %}q={{ current_query|urlencode }}{% endif %}">すべて</a>
      {% for category in categories %}
        <a class="category-pill{% if current_category == category.value %} is-active{% endif %}"
           href="?cat={{ category.value|urlencode }}{% if current_query %}&amp;q={{ current_query|urlencode }}{% endif %}">{{ category.label }}</a>
      {% endfor %}
    </section>
  {% endif %}

  {# 検索条件が指定されている場合は条件を表示する #}
  {% if current_query or current_category %}
    <p class="search-result-meta">検索条件：
      {% if current_query %}<span>キーワード「{{ current_query }}」</span>{% endif %}
      {% if current_category %}<span>カテゴリ「{{ current_category_label|default:current_category }}」</span>{% endif %}
    </p>
  {% endif %}

  {# 新着書籍一覧。カードレイアウトで最新の投稿を表示 #}
  <section class="section">
    <div class="section__heading">新着書籍</div>
    {% if object_list %}
      <div class="book-grid">
        {% for item in object_list %}
          <article class="book-card">
            <div class="book-card__thumb">
              {% if item.thumbnail %}
                <img src="{{ item.thumbnail.url }}" alt="{{ item.title }}" loading="lazy" />
              {% else %}
                <div class="book-card__thumb--placeholder">No Image</div>
              {% endif %}
            </div>
            <div class="book-card__body">
              <h3 class="book-card__title">{{ item.title }}</h3>
              <p class="book-card__text">{{ item.text|truncatechars:60 }}</p>
              <div class="book-card__meta">
                <span class="category-pill small">{{ item.get_category_display }}</span>
                <a class="book-card__link" href="{% url 'book:detail-book' item.pk %}">詳細へ</a>
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="empty">該当する書籍が見つかりませんでした。</p>
    {% endif %}
    <div class="section__footer">
      {# 一覧ページへの導線。より多くの書籍を見たいとき用 #}
      <a class="btn primary" href="{% url 'book:list-book' %}">書籍一覧</a>
    </div>
  </section>

  {# レビューの平均点が高い書籍をランキング形式で表示する #}
  <section class="section">
    <div class="section__heading">評価順ランキング</div>
    {% if ranking_list %}
      <div class="book-grid small">
        {% for ranking_book in ranking_list %}
          <article class="book-card">
            <div class="book-card__thumb">
              {% if ranking_book.thumbnail %}
                <img src="{{ ranking_book.thumbnail.url }}" alt="{{ ranking_book.title }}" loading="lazy" />
              {% else %}
                <div class="book-card__thumb--placeholder">No Image</div>
              {% endif %}
            </div>
            <div class="book-card__body">
              <h3 class="book-card__title">{{ ranking_book.title }}</h3>
              <p class="book-card__rating">平均評価：{{ ranking_book.avg_rating|default:"0"|floatformat:1 }}点</p>
              <a class="book-card__link" href="{% url 'book:detail-book' ranking_book.id %}">評価を見る</a>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="empty">ランキング対象の書籍がありません。</p>
    {% endif %}
  </section>
{% endblock content %}
